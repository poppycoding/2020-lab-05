;/*!question-new:widget/ask/replyer/replyer.js*/
define("question-new:widget/ask/replyer/replyer",function(e){function t(e){var t="1"===F.context("user").isLogin,i="1"===F.context("page").isAdopted,o=!!window.isQualityView,n="1"===F.context("newbest"),a=(F.context("page").supply,["该提问求助发自手机，请精简回答，方便查看","如最佳答案内容有误，欢迎提交正确答案。<br>让你的知识，帮到更多需要帮助的人...","提问者正在等待您的回答","请输入您的回答...","详细的问题说明，有助于回答者给出准确的答案","1.步骤类：①整体简介②所需工具/原料③方法/步骤④注意事项<br>2.常识类：①直接回答问题②详细给出具体原因/理由/介绍<br>3.原因类：①详细解释原因/理由②提供有效解决方案（构成见步骤类）<br>4.其他类型详见高质量标准（点击回答框右侧图片）"]),s="";s=n?a[1]:o?a[5]:t&&i?a[3]:a[2];var r=["fullscreen","bold","italic","paragraph","insertorderedlist","insertunorderedlist","blockquote","|","link","insertimage","insertvideo","map","template"];"74"===F.context("page").cidTop&&r.push("|","insertcode");var u=d.getEditor("answer-editor",{initialFrameWidth:"100%",initialFrameHeight:280,toolbars:[r],initialContent:e?e:s,maximumWords:9999,token:F.context("user").stoken});return u.iknowInit({isLogin:t,authcode:"new_reply",submitBtn:"提交回答",anonymouse:!0},function(e){e&&c(e).click(l)}),u}function i(){c(_.container).hasClass("iknow-editor-fullscreen")&&_&&_.submitBtn&&(_.submitBtn.style.display="none");var e=c(".layerBg"),t=c("#edui1"),i=t.width()-2,o=t.height()-2,n="height:"+o+"px;width:"+i+"px";if(e.length)e.attr("style",n).show();else{var a=c("<div style='"+n+"' class='layerBg'></div>"),s=c("<span class='loading-layer'></span>");t.append(a,s)}}function o(e,t){if(c(".loading-layer").hide(),c(".layerBg").hide(),c("."+e).length)c("."+e).show();else{var i=c("#edui1"),o=i.width()-2,n=(i.height()-2,c("<div class='tipLayer'></div>"));i.append(n);var a=c(".tipLayer");a.attr("class","tipLayer "+e).html("<span class='icon'></span><div>"+t+"</div>"),a.css("margin-left",(o-c(".tipLayer").width())/2+"px")}}function n(e){var t="",i=[],o=O.length;c(".loading-layer").hide(),c(".layerBg").hide(),o.length<=3?(c.each(O,function(e,i){t+=['<div class="visit-join-model-item">','<a target="_blank" href="/uteam/view?teamId='+i.teamId+'" class="visit-join-model-img"><img src="'+i.imgUrl+'" alt=""></a>','<h3><a target="_blank" href="/uteam/view?teamId='+i.teamId+'">'+(i.teamName.length>7?i.teamName.slice(0,7):i.teamName)+"</a></h3>","<p><span>"+i.cname+"</span>"+i.userNum+"人</p>",'<a href="javascript:void(0);" data-teamid="'+i.teamId+'" class="visit-join-model-btn">加入</a></div>'].join("")}),i.push(t)):c.each(O,function(e,n){t+=['<div class="visit-join-model-item"><a target="_blank" href="/uteam/view?teamId='+n.teamId+'" class="visit-join-model-img"><img src="'+n.imgUrl+'" alt=""></a>','<h3><a target="_blank" href="/uteam/view?teamId='+n.teamId+'">'+(n.teamName.length>7?n.teamName.slice(0,7):n.teamName)+"</a></h3>","<p><span>"+n.cname+"</span>"+n.userNum+"人</p>",'<a href="javascript:void(0);" data-teamid="'+n.teamId+'" class="visit-join-model-btn">加入</a></div>'].join(""),((e+1)%3===0&&0!==e||e===o-1)&&(i.push(t),t="")}),g.alert(k.html(),{className:"visit-join-model-wrap",title:"回答已提交",width:500,height:396,open:function(){var t,n,a=c("#visit-join-model-content");I||(I=new f({direction:"horizontal",controls:!1,activeIndex:0,items:i,interval:0}),I.render(a)),t=a.find(".visit-join-model-btn"),t.click(function(){var e=c(this);e.hasClass("visit-join-model-active")?e.removeClass("visit-join-model-active"):(t.removeClass("visit-join-model-active"),e.addClass("visit-join-model-active"))}),n=a.find(".visit-join-control"),3>=o?n.hide():n.click(function(){var e=c(this),t=e.data("action"),i=0,o=I.items.length;"left"===t?e.hasClass("visit-join-control-left-disable")||(I.prev(),i=I.getActiveIndex()-1,0>=i?e.addClass("visit-join-control-left-disable"):e.removeClass("visit-join-control-left-disable"),e.siblings().removeClass("visit-join-control-right-disable")):e.hasClass("visit-join-control-right-disable")||(I.next(),i=I.getActiveIndex()+1,i>=o-1?e.addClass("visit-join-control-right-disable"):e.removeClass("visit-join-control-right-disable"),e.siblings().removeClass("visit-join-control-left-disable"))}),c(".visit-join-model-wrap .ui-dialog-titlebar-close").click(function(){c.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e()})},buttons:[{text:"确定",click:function(){var t,i=c("#visit-join-model-content"),o=i.find(".visit-join-model-btn"),n=c("#visit-join-warn");o.each(function(){var e=c(this);return e.hasClass("visit-join-model-active")?(t=e,!0):void 0}),t?(c.post("/uteam/submit/applyJoin",{fr:"recalert",teamId:t.data("teamid")},function(t){"string"==typeof t&&(t=c.parseJSON(t)),g.close(),0!==t.errno?g.alert(t.errmsg,{className:"visit-join-model-error",open:function(){c(".visit-join-model-error .ui-dialog-titlebar-close").click(function(){c.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e()})},buttons:[{text:"确定",click:function(){c.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e()}}]}):(c.cookie.set("VISIT_VISIT_MODEL","show",{expires:6048e5,path:"/"}),e&&e())}),u.send({module:"question",action:"visit-join",page:"unview",area:"join-alert"})):(n.animate({height:24}),setTimeout(function(){n.animate({height:0})},1e3))}}]}),u.send({module:"question",action:"visit-join",page:"unview",area:"alert"})}function a(e){u.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",addtagsHatch:1});var t=p(c("#replyer-addtags-tmpl").html());c("body").append(t.render(e));var i=Number(w.get("showCount"))+1;w.set("showCount",i),c(".tags-box").on("click","li",function(){var e=c(this);e.hasClass("selected")?e.removeClass("selected"):e.addClass("selected")}),c(".addtags-box").on("click",".addtags-close",function(){c(".addtags-box").remove(),location.reload()}).on("click",".addtags-notip",function(){c(".addtags-box").remove(),u.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",addtagsNotip:1}),w.set("addtagsHatch","notip"),location.reload()}).on("click",".addtags-sub",function(){var e=s();0===e.length?(u.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",notAddtags:1}),window.open("https://zhidao.baidu.com/ihome#body"),location.reload()):(u.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",hasAddtags:1}),c.ajax({url:"/submit/user",type:"post",dataType:"json",data:{cm:100522,tags:e,stoken:F.context("user").stoken}}).done(function(e){0===e.errorNo?setTimeout(function(){window.location="https://zhidao.baidu.com/ihome#body"},500):g.alert(e.errorMsg)}).fail(function(){g.alert("网络故障，请重试")}))})}function s(){var e=[];return c(".tags-box li").each(function(){var t=c(this);t.hasClass("selected")&&e.push(t.text())}),e.join("	")}function r(){u.addKey({subHatch:1});var e=p(c("#replyer-tags-tmpl").html());c("body").append(e.render()),w.set("subshowCount",Number(w.get("subshowCount"))+1),c(".tags-content").on("click",".tags-close",function(){c(".tags-box").remove(),location.reload()}).on("click",".tags-notip",function(){c(".tags-box").remove(),u.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",subaddtagsNotip:1}),w.set("skipHatch","notip"),location.reload()}).on("click",".tags-sub",function(){u.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",subHatchskip:1}),window.open("https://zhidao.baidu.com/ihome#body"),location.reload()})}function l(e){if(e.preventDefault(),!j){j=!0,setTimeout(function(){j=!1},1e3);var t={cm:100009,qid:F.context("page").qid,title:F.context("extra").title,answerfr:F.context("extra").answerfr,feedback:F.context("feedback"),entry:F.context("extra").entry};if(0==F.context("user").isNew&&0!=c.cookie.get("IK_FORCE_UHOME")&&c.cookie.set("IK_FORCE_UHOME","0",{expires:31536e6,path:"/"}),_.checkEditor()){var s=_.getEditorContent();t.co=s,t.cite="",t.rich=1,t.edit="new",_.authcode&&_.authcode.submitParam(t),_.anonymouse&&_.anonymouse.checked&&(t.anoy=1);var l="";t.co&&t.co.match(/<strong>/)&&t.co.match(/<em>/)?l="both":t.co&&t.co.match(/<strong>/)?l="replyBold":t.co&&t.co.match(/<em>/)&&(l="replyRed"),u.send({type:2014,page:"question",action:"answer",privilegeSubmit:l,uid:F.context("user").uid}),i(),h.fire("login.check",{isLogin:function(e){function i(){new m({params:t,hasJump:!1,syncId:"answer",jumpSubmitDelay:4500,beforeJump:function(e,t){0==F.context("user").isNew&&0==F.context("user").isHaveCid&&c.ajax({type:"post",url:"/submit/user",data:{cm:100522,word:F.context("page").cid,stoken:F.context("user").stoken}});var i="normal";if("SHOW"!==w.get("LIFESTYLE_ACT_UNIVERSITY_DIALOG")||c("#answer-for-lottery").size()){if(c("#answer-for-lottery").size()){var s=p(c("#answer-for-lottery").html());i="datichoujiang"}else{w.set("LIFESTYLE_ACT_UNIVERSITY_DIALOG","SHOW");var s=p(c("#government-affairs-template").html());i="LIFESTYLE_ACT_UNIVERSITY_DIALOG"}c("body").append(s.render(t)),c(".affairs-box").on("click",".affairs-close",function(){c(".affairs-box").remove();var e=location.href;if(e.indexOf("hideOtherAnswer")<0)if(e.indexOf("?")>0)location.href=e+="&hideOtherAnswer=true&newAnswer=1";else if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));location.href=t+="?hideOtherAnswer=true&newAnswer=1"}else location.href=e+="?hideOtherAnswer=true&newAnswer=1";else location.reload()})}else if(O&&O.length&&"show"!==c.cookie.get("VISIT_VISIT_MODEL"))n(function(){var e=location.href;if(e.indexOf("hideOtherAnswer")<0)if(e.indexOf("?")>0)location.href=e+="&hideOtherAnswer=true&newAnswer=1";else if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));location.href=t+="?hideOtherAnswer=true&newAnswer=1"}else location.href=e+="?hideOtherAnswer=true&newAnswer=1"});else{w.get("showCount")||w.set("showCount",0),w.get("subshowCount")||w.set("subshowCount",0);var l=!F.context("user").tag&&"notip"!==w.get("addtagsHatch")&&w.get("showCount")<2,d=F.context("user").tag&&0!==F.context("user").tag.length&&"notip"!==w.get("skipHatch")&&w.get("subshowCount")<2;l&&"true"===F.context("isUnview")?c.ajax({url:"/misc/getrecommendtag",type:"post",dataType:"json",data:{qid:F.context("page").qid}}).done(function(e){0===e.error?a(e.data):g.alert(e.errorMsg)}).fail(function(){g.alert("网络故障，请重试")}):d&&"true"===F.context("isUnview")?r():(o("success-tip","您的回答已提交成功"),setTimeout(function(){var e=location.href;if(e.indexOf("hideOtherAnswer")<0)if(e.indexOf("?")>0)location.href=e+="&hideOtherAnswer=true&newAnswer=1";else if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));location.href=t+="?hideOtherAnswer=true&newAnswer=1"}else location.href=e+="?hideOtherAnswer=true&newAnswer=1"},2e3))}u.send({module:"question",page:"reply-question",area:"submit",action:"submit-success",rid:t.aid,qid:F.context("page").qid,beforeDialog:i})},beforeError:function(){c(".loading-layer").hide(),c(".layerBg").hide()},authcode:_.authcode||null})}({tn:"ikqb",qid:F.context("page").qid,user:F.context("user").name,referrer:encodeURIComponent(document.referrer)});localStorage.removeItem("HAS_NOT_COMMIT_ID"),localStorage.removeItem("HAS_NOT_COMMIT_CONTENT"),1===e.isRealName&&0===c("#passport-accRealName-pop").length?h.fire("login.realName",{onHide:function(){c(".loading-layer").hide(),c(".layerBg").hide()},onSubmitSuccess:function(){i()}}):1===e.isRealName&&c("#passport-accRealName-pop").length>0?(c("#passport-accRealName-pop").show(),c("body").children("div:first-child").show(),c("#passport-accRealName-pop").is(":hidden")?(c(".loading-layer").hide(),c(".layerBg").hide()):(c(".loading-layer").show(),c(".layerBg").show())):i()},noLogin:function(){c(".loading-layer").hide(),c(".layerBg").hide(),localStorage.setItem("HAS_NOT_COMMIT_ID",F.context("page").qid),localStorage.setItem("HAS_NOT_COMMIT_CONTENT",t.co),h.fire("login.log",{onLoginSuccess:function(e){e&&(F.context("user").stoken=e.stoken),1===e.isRealName?(c(".loading-layer").hide(),c(".layerBg").hide()):new m({params:t,hasJump:!1,syncId:"answer",beforeJump:function(){O&&O.length&&"show"!==c.cookie.get("VISIT_VISIT_MODEL")?n(function(){var e=location.href;if(e.indexOf("hideOtherAnswer")<0)if(e.indexOf("?")>0)location.href=e+="&hideOtherAnswer=true";else if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));location.href=t+="?hideOtherAnswer=true"}else location.href=e+="?hideOtherAnswer=true"}):(o("success-tip","您的回答已提交成功"),setTimeout(function(){var e=location.href;if(e.indexOf("hideOtherAnswer")<0)if(e.indexOf("?")>0)location.href=e+="&hideOtherAnswer=true";else if(e.indexOf("#")>0){var t=e.substring(0,e.indexOf("#"));location.href=t+="?hideOtherAnswer=true"}else location.href=e+="?hideOtherAnswer=true"},2e3))},beforeError:function(){c(".loading-layer").hide(),c(".layerBg").hide()},authcode:_.authcode||null})}})}})}}}var c=e("common:widget/js/util/tangram/tangram"),d=e("common:widget/js/logic/ueditor/ueditor"),u=e("common:widget/js/util/log/log"),h=e("common:widget/js/util/event/event"),m=e("common:widget/js/logic/submit/submit"),g=e("common:widget/js/ui/dialog/dialog"),f=e("common:widget/js/ui/carousel/carousel"),p=e("common:widget/lib/juicer/juicer"),w=e("common:widget/js/util/store/store"),v=e("question-new:widget/ask/editor-guide/editor-guide");e("question-new:widget/js/app-guide/app-guide");var b=c("#answer-bar"),y="down",x={ql:/browse(?:\/\d+(?:$|\?lm=2|\?[^lm])|$|\/$|\/\?lm=2)/i,ql_tab_hscore:/browse\/\d*\?lm\=4/,ql_tab_zero:/browse\/\d*\?lm\=8/,ql_tab_emergency:/browse\/\d*\?lm\=16/,zhuanti:/zhidao\.baidu\.com\/s\/([a-zA-Z0-9_\-]+)/,search:/zhidao\.baidu\.com\/search/};!function(){var e,t=document.referrer,i="";for(var o in x)if(e=t.match(x[o])){i=o;break}if(i&&"zhuanti"==i&&(i=e[1]),!i){var n=c.url.queryToJson(location.search||"");n&&"uc_push"==n.fr&&(i="keyword"==n.push?"uc_tab_keyword":"category"==n.push?"uc_tab_class":"uc_tab_recommand")}var a=F.context("page").isFromWap,s=i+(parseInt(a)?";wap_question_replyed":"");F.context("extra",{title:s,answerfr:s})}();var _=null;u.addKey({has_better_answer_btn:b.length&&b.is(":visible")?1:0}),b.click(function(){var e=c(this).text();u.send({module:"question",action:"click",page:"replyer",area:"have-better-answer-btn",btn_type:e,isLogin:"1"===F.context("user").isLogin?1:0}),_=_||t(),"down"===y?(_.expandEditor(function(e){e.style.overflow="inherit",c("#answer-editor").css({visibility:"inherit"})}),y="up",c(".wgt-search-relate, .search-relate").show()):(_.collapseEditor(function(e){e.style.overflow="hidden",c("#answer-editor").css({visibility:"hidden"})}),y="down",c(".wgt-search-relate, .search-relate").hide())}),function(){var e={home:/zhidao\.baidu\.com\/$/,browse:/zhidao\.baidu\.com\/browse/,ihome:/zhidao\.baidu\.com\/ihome(?!\/hangjia)/,qb:/zhidao\.baidu\.com\/question/,hangjia:/zhidao\.baidu\.com\/mavin\/home\/index/,team:/zhidao\.baidu\.com\/team/},t=location.href,i=document.referrer,o=c.url.getQueryValue(t,"entry")||"";if(""==o){for(var n in e)if(i.match(e[n])){o="qb_"+n+"_none";break}o=""==o?"qb_none_none":o}F.context("extra").entry=o}();var I=null,O=F.context("visitJoin"),k=c("#visit-join-model-template"),j=!1;!function(){if(F.context("page").relatedKeyword)return void window.isQualityView;c("<a/>").html('<span class="iknow-icons">&#xe631;</span>搜索资料').addClass("search-relate").attr("href","http://www.baidu.com/s?wd="+encodeURIComponent(F.context("page").title)+"&ie=utf-8").attr("target","_blank").hide().insertBefore("#answer-bar")}(),("1"!==F.context("page").isView||"1"===F.context("isForAnswerHq")||"1"===F.context("isForceAnswer")||F.context("page").qid===localStorage.getItem("HAS_NOT_COMMIT_ID")&&"1"===F.context("user").isLogin)&&c(function(){_=_||t(v.content),v(_),_.addListener("ready",function(){localStorage.getItem("HAS_NOT_COMMIT_CONTENT")&&F.context("page").qid===localStorage.getItem("HAS_NOT_COMMIT_ID")&&_.setEditorContent(localStorage.getItem("HAS_NOT_COMMIT_CONTENT"))}),c(".wgt-search-relate, .search-relate").show(),b.hide()});var T=c(".wgt-replyer-line").find(".wgt-askreplyer-lottery-card");if(T.size()){var C;c(".wgt-replyer-line").on("mouseenter",".wgt-askreplyer-lottery",function(){C=setTimeout(function(){T.show()},300)}).on("mouseleave",".wgt-askreplyer-lottery",function(){clearTimeout(C),C=setTimeout(function(){T.hide()},300)}).on("mouseenter",".wgt-askreplyer-lottery-card",function(){clearTimeout(C)}).on("mouseleave",".wgt-askreplyer-lottery-card",function(){c(this).hide()})}});