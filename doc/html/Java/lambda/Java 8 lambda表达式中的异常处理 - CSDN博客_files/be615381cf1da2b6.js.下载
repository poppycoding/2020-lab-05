var baseJs={time:8,ct:0,ut:0,firstClick:!0,broken:[],init:function(){$(".lastTimes span").html(this.time);var e=this;e.protocol=window.location.protocol,e.showId=e._getQueryString("si"),e.containerID=e._getQueryString("containerID"),window.addEventListener("message",function(t){if(e.containerID!=t.data.containerID)return!1;"ADDataReady"==t.data.action&&(window.newAwards=t.data.data,window.clickPlugin=t.data.clickPlugin,window.gameData=t.data.pluginData,window.backupData=t.data.backupData,e.game=t.data.game,e.setGameData()),"askOpenDialog"==t.data.action&&window.parent.postMessage({action:"openMyAward",containerID:e.containerID,list:JSON.parse(window.localStorage.getItem("myAward"))},"*")}),e._setRem(),e.getInfos(),e.setRemainTimes(),e.openAward(),e.clickEggs(),e.brokenStatus()},_setRem:function(){var e=document.documentElement,t="orientationchange"in window?"orientationchange":"resize",a=function(){var t=e.clientWidth||375;(t=t>750?750:t)&&(e.style.fontSize=t/375*20+"px",window.remscale=t/375)};document.addEventListener&&(window.addEventListener(t,a,!1),document.addEventListener("DOMContentLoaded",a,!1))},brokenStatus:function(){var e=JSON.parse(window.localStorage.getItem("brokenStatus"))||[];this.broken=e,e.forEach(function(e){e=parseInt(e),$(".eggsList").eq(e).children(".eggs").hide(),$(".eggsList").eq(e).children(".eggsClick").show()})},clickEggs:function(){var e=this;$(".eggsList").on("mousedown",function(t){e.ct=(new Date).getTime()}).on("mouseup",function(){e.ut=(new Date).getTime()}),$(".eggsList").on("click",function(){if(baseJs.firstClick&&(window.parent.postMessage({action:"clickGame",containerID:e.containerID},"*"),baseJs.firstClick=!1),"block"!=$(this).children(".eggsClick").css("display")){if(0==e.times)return void e.clickBtn(!1);e.clickBtn(!0);var t=$(this),a=t.index();if(0==a?$(".hammer").removeClass("hammerMove2").removeClass("hammerMove3").addClass("hammerMove1"):1==a?$(".hammer").removeClass("hammerMove1").removeClass("hammerMove3").addClass("hammerMove2"):2==a&&$(".hammer").removeClass("hammerMove1").removeClass("hammerMove2").addClass("hammerMove3"),e.times<3){e.broken.push(a);try{localStorage.setItem("brokenStatus",JSON.stringify(e.broken))}catch(i){e.setCookie("brokenStatus",JSON.stringify(e.broken))}}var n=!0;document.getElementById("hammer").addEventListener("animationend",function(i){if(i.target===this&&n){n=!1;var s=$(this);t.children(".eggs").hide(),t.children(".eggsClick").show(),setTimeout(function(){s.removeClass("hammerMove1").removeClass("hammerMove2").removeClass("hammerMove3"),e.times>=3&&($(".eggsList").eq(a).children(".eggsClick").hide(),$(".eggsList").eq(a).children(".eggs").show())},500)}},!1)}else if(0==e.times)return void e.clickBtn(!1)})},_getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},getInfos:function(){var e=0,t=this,a=window.setInterval(function(){if(e++,window.newAwards){for(var n in newAwards.ads)newAwards.ads[n].impurl=newAwards.impurl,newAwards.ads[n].imptk.push(newAwards.impurl+newAwards.ads[n].imparg);window.clearInterval(a)}e>3&&!window.newAwards&&(t.askData(),e=0)},100)},askData:function(){window.parent.postMessage({action:"askADData",containerID:this.containerID,si:this.showId},"*")},openDialog:function(e){window.parent.postMessage({action:"openDialog",data:e,containerID:this.containerID,si:this.showId},"*")},clickBtn:function(e){if("undefined"==typeof newAwards)return!1;var t=this;if(e){t.adClickPlugin(t.ct,t.ut,t.times),t.times-=1,t.times=t.times>0?t.times:0,$(".lastTimes").find("span").html(t.times);try{localStorage.setItem("timesEggsMin"+t.showId,t.time-t.times)}catch(s){t.setCookie("timesEggsMin"+t.showId,t.time-t.times)}try{if(!newAwards||!newAwards.ads){var a={type:"none"};return void t.openDialog(a)}if(0==newAwards.ads.length){var a={type:"none"};return void t.openDialog(a)}var n=newAwards.ads.shift(),a={item:n,title:n.desc,ticket:n.img,btntext:"\u7acb\u5373\u9886\u53d6",awardlink:n.curl,type:"bingo"};t.saveAward(n);var i=!0;document.getElementById("hammer").addEventListener("animationend",function(e){e.target===this&&i&&(i=!1,t.openDialog(a))})}catch(o){}}else{var a={type:"over"};t.openDialog(a)}},setRemainTimes:function(){var e=this;try{var t=localStorage.getItem("timesEggsMin"+e.showId)}catch(a){var t=e.getCookie("timesEggsMin"+e.showId)}e.isDateChange()?(e.times=e.time,baseJs.syncRemains(e.times)):(e.times=e.time-t,baseJs.syncRemains(e.times)),$(".lastTimes").find("span").html(e.times)},openAward:function(){var e=this;$("#myAwards").on("click",function(){window.parent.postMessage({action:"openMyAward",containerID:e.containerID,list:JSON.parse(window.localStorage.getItem("myAward"))},"*")})},isDateChange:function(){var e="",t=this,a=new Date;if(!this.showId)return!1;a=""+a.getFullYear()+(a.getMonth()+1)+a.getDate();try{e=localStorage.getItem("rawDateEggsMin"+t.showId)}catch(n){e=baseJs.getCookie("rawDateEggsMin"+t.showId)}if(a!=e){try{localStorage.setItem("rawDateEggsMin"+t.showId,a),localStorage.removeItem("statusEggsMin"+t.showId),localStorage.removeItem("timesEggsMin"+t.showId),localStorage.removeItem("brokenStatus")}catch(n){baseJs.setCookie("rawDateEggsMin"+t.showId,a,1),baseJs.delCookie("statusEggsMin"+t.showId),baseJs.delCookie("timesEggsMin"+t.showId),baseJs.delCookie("brokenStatus")}return!0}return!1},adClickPlugin:function(e,t,a){var n=this,i=window.clickPlugin;if(!window.clickPlugin)return!1;i=i.replace("__EVENT_TIME_START__",e).replace("__EVENT_TIME_END__",t).replace("__ACT_NUM__",a),baseJs.syncRemains(a),$.each(i.split(","),function(e,t){n.sendLog(t)})},sendLog:function(e){window.parent.postMessage({action:"sendLog",url:e,containerID:this.containerID,si:this.showId},"*")},syncRemains:function(e){window.parent.postMessage({action:"syncRemains",containerID:this.containerID,times:e},"*")},saveAward:function(e){var t=JSON.parse(window.localStorage.getItem("myAward"))||[],a=!1;if(t.length>0)for(var n=0;n<t.length;n++){t[n].desc==e.desc&&(a=!0);var i=(new Date).getTime();i-t[n].expireDate>=6048e5&&t.splice(n,1)}a||(e.expireDate=(new Date).getTime(),t.push(e),window.localStorage.setItem("myAward",JSON.stringify(t)))},setGameData:function(){var e=JSON.parse(window.gameData.dj_interaction),t=e.skin.styleUrl?e.skin.styleUrl:"//cjhd.mediav.com/css/eggs/eggs_default.css";$("head").append('<link rel="stylesheet" href="'+t+'" type="text/css"/>'),$(".wrap").fadeIn(1e3),$(".page-loading").fadeOut(1e3)}};